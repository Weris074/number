<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ò–≥—Ä–∞ –£–≥–∞–¥–∞–π –ß–∏—Å–ª–æ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
            animation: bg-pulse 20s infinite alternate; 
            min-height: 100vh; 
            position: relative; 
            padding-bottom: 120px; 
            box-sizing: border-box;
        }
        
        @keyframes bg-pulse {
            from {background-position: 0%; transform: scale(1);} 
            to {background-position: 100%; transform: scale(1.02); animation-timing-function: ease-in-out;} 
        }
        
        h1 {
            color: white;
            font-size: 3rem;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        input[type=number], button {
            padding: 20px;
            font-size: 20px;
            border-radius: 15px;
            outline: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            margin: 5px; 
        }
        
        input[type=number] {
            width: 60%; 
            box-sizing: border-box; 
            display: inline-block; 
        }

        .input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .input-group button {
            width: 30%; 
            flex-shrink: 0; 
        }

        .action-group {
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .action-group button {
            width: 45%; 
            max-width: 200px; 
        }

        input[type=number]:hover,
        button:hover {
            background-color: #fffaf0;
            transform: scale(1.05);
        }
        
        input[type=number]:focus,
        button:focus {
            background-color: #ffe4b5;
        }
        
        p#result {
            font-weight: bold;
            color: green;
            font-size: 1.5rem;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from {transform: scale(1)}
            to {transform: scale(1.05)}
        }
        
        p#message {
            font-style: italic;
            color: white;
            font-size: 1.2rem;
            text-shadow: 2px 2px 2px rgba(0,0,0,2);
        }
        
        ul#clues-list li {
            list-style-type: circle;
            line-height: 1.5em;
            color: #333; 
            text-shadow: none; 
            text-align: left; 
            max-width: 400px;
            margin: 0 auto 5px;
        }
        
        .green-text { color: limegreen !important; }
        .yellow-text { color: gold !important; }
        .blue-text { color: dodgerblue !important; }
        .red-text { color: tomato !important; }

        #achievements-container {
            margin-top: 40px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            display: none; 
            margin-bottom: 20px; 
        }
        #achievements-container h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .achievement-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #555;
            text-align: left; 
        }
        .achievement-item.unlocked {
            color: #28a745; 
            font-weight: bold;
        }
        .achievement-item::before {
            content: 'üîí';
            margin-right: 10px;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .achievement-item.unlocked::before {
            content: 'üèÜ'; 
        }

        #toggle-achievements-button-wrapper {
            position: absolute; 
            bottom: 80px; 
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            width: 100%; 
            z-index: 10; 
        }

        #toggle-achievements-button {
            padding: 10px 15px;
            font-size: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            min-width: 150px;
        }
        #toggle-achievements-button:hover {
            background-color: #0056b3;
        }

        #footer-buttons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%); 
            display: flex;
            flex-wrap: wrap; 
            gap: 10px;
            justify-content: center; 
            max-width: 90%; 
            z-index: 1; 
        }
        #footer-buttons button {
            padding: 10px 15px;
            font-size: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            min-width: 120px; 
        }
        #footer-buttons button:hover {
            background-color: #0056b3;
        }

        #clues-header {
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        #background-settings {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0,0,0,0.1);
        }
        #background-settings button {
            padding: 8px 12px;
            font-size: 0.9rem;
            margin: 3px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div id="range-settings" style="display: none; margin-bottom: 20px;">
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –î–∏–∞–ø–∞–∑–æ–Ω–∞</h2>
    –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ: <input type="number" id="minRangeInput" value="1" min="1" max="99"><br><br>
    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ: <input type="number" id="maxRangeInput" value="100" min="2" max="1000"><br><br>
    <button onclick="startGameWithRange()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É —Å —ç—Ç–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º</button>

    <div id="background-settings">
        <h3>–í—ã–±–æ—Ä –§–æ–Ω–∞</h3>
        <button onclick="setBackground('peach')">–ü–µ—Ä—Å–∏–∫–æ–≤—ã–π</button>
        <button onclick="setBackground('dark')">–¢—ë–º–Ω–∞—è –¢–µ–º–∞</button>
        <button onclick="setBackground('green_yellow')">–õ—É–≥</button>
        <button onclick="setBackground('paper')">–•–æ–ª—Å—Ç –ë—É–º–∞–≥–∏</button>
    </div>
</div>

<h1 id="game-title">üéâ –ò–≥—Ä–∞ ¬´–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ!¬ª üéâ</h1>
<p id="message">–ü–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!</p>

<div class="input-group">
    <input type="number" min="1" max="100" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ..." id="guessInput">
    <button id="check-button" onclick="checkGuess()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å!</button>
</div>

<div class="action-group">
    <button id="get-clue-button" onclick="getNewClue()"></button>
    <button id="reset-button" onclick="resetGame()"></button>
</div>

<p id="result"></p>
<div id="clues-header">–ü–æ–¥—Å–∫–∞–∑–∫–∏:</div>
<ul id="clues-list"></ul>

<div id="achievements-container">
    <h2 id="achievements-title">–¢–≤–æ–∏ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
    <div id="achievements-list">
    </div>
</div>

<div id="toggle-achievements-button-wrapper">
    <button id="toggle-achievements-button" onclick="toggleAchievements()"></button>
</div>

<div id="footer-buttons">
    <button id="toggle-range-button" onclick="toggleRangeSettings()"></button>
    <button id="report-button" onclick="reportBug()"></button>
    <button id="lang-button" onclick="toggleLanguage()"></button>
</div>

<script>
const GAME_VERSION = 'v9.5';
let targetNumber;
let attempts;
let minNumber = 1; 
let maxNumber = 100; 
let history = []; 
let clues = []; 
let availableClueOptions = []; 
let usedClueTypesInCurrentGame = new Set(); 
let currentLang = localStorage.getItem('guessTheNumberLang') || 'ru'; 
let isWon = false; 
let consecutiveLosses = parseInt(localStorage.getItem('guessTheNumberLosses')) || 0; 
let currentBackground = localStorage.getItem('guessTheNumberBackground') || 'peach'; 

const backgrounds = {
    'peach': 'linear-gradient(to right bottom, #f7eae1, #fadbc8)', 
    'dark': 'linear-gradient(to right bottom, #2c3e50, #000000)',
    'green_yellow': 'linear-gradient(to right bottom, #a8e063, #56ab2f)',
    'paper': 'linear-gradient(to right bottom, #f5f5dc, #ffffff)',
};

const texts = {
    'ru': {
        gameTitle: 'üéâ –ò–≥—Ä–∞ ¬´–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ!¬ª üéâ',
        messageInitial: '–ü–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!',
        messageWithRange: (min, max) => `–ü–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ –æ—Ç ${min} –¥–æ ${max}!`,
        inputPlaceholder: '–í–≤–µ–¥–∏ —á–∏—Å–ª–æ...',
        checkButton: '‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å!',
        resetButton: 'üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É',
        getClueButton: '‚ùì –ü–æ–¥—Å–∫–∞–∑–∫–∞',
        toggleAchievementsButton: 'üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è',
        resultEnterNumber: (min, max) => `–ù—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ –æ—Ç ${min} –¥–æ ${max}!`,
        resultInvalidRange: '–ù–µ–≤–µ—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —á–∏—Å–µ–ª! –ú–∏–Ω. —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 99, –ú–∞–∫—Å. –æ—Ç 2 –¥–æ 1000, –∏ –ú–∏–Ω. –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –ú–∞–∫—Å.',
        resultAlreadyGuessed: '–¢—ã —É–∂–µ —ç—Ç–æ —á–∏—Å–ª–æ –≤–≤–æ–¥–∏–ª! –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–µ.',
        resultCorrect: (num, att) => `üéâ –í–µ—Ä–Ω–æ! –¢—ã —É–≥–∞–¥–∞–ª —á–∏—Å–ª–æ ${num}. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫: ${att} üéâ`,
        resultTooHigh: '–ù–µ–≤–µ—Ä–Ω–æ! –°–¥–µ–ª–∞–π —á–∏—Å–ª–æ –ø–æ–º–µ–Ω—å—à–µ.',
        resultTooLow: '–ù–µ–≤–µ—Ä–Ω–æ! –°–¥–µ–ª–∞–π —á–∏—Å–ª–æ –ø–æ–±–æ–ª—å—à–µ.',
        cluesHeader: '–ü–æ–¥—Å–∫–∞–∑–∫–∏:',
        noMoreClues: '–ë–æ–ª—å—à–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫!',
        achievementsTitle: '–¢–≤–æ–∏ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è',
        achievements: {
            'genius_guess': { name: '–û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ –¥–ª—è –≥–µ–Ω–∏—è', description: '–£–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ —Å 1 —Ä–∞–∑–∞' },
            'easy_peasy': { name: '–≠—Ç–æ –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ', description: '–£–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ –¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫' },
            'first_win': { name: '–Ø —Å–¥–µ–ª–∞–ª —ç—Ç–æ', description: '–£–≥–∞–¥–∞—Ç—å –≤–ø–µ—Ä–≤—ã–µ' },
            'encyclopedist': { name: '–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—Å—Ç', description: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 5 —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∑–∞ –∏–≥—Ä—É' },
            'clue_sniper': { name: '–°–Ω–∞–π–ø–µ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫', description: '–£–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ, –∑–∞–ø—Ä–æ—Å–∏–≤ –Ω–µ –±–æ–ª–µ–µ 2 –ø–æ–¥—Å–∫–∞–∑–æ–∫' },
            'big_range_win': { name: '1 –º–∏–Ω–∞, –±–æ–ª—å—à–æ–µ –ø–æ–ª–µ', description: '–í—ã–∏–≥—Ä–∞—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Å max > 200' }, 
            'foreign_no_clue': { name: '–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—à—å?', description: '–í—ã–∏–≥—Ä–∞—Ç—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫' }, 
            'impossible_challenge': { name: '–≠—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ', description: '–ü—Ä–æ–∏–≥—Ä–∞—Ç—å 5 –∏–≥—Ä –ø–æ–¥—Ä—è–¥, –∑–∞—Ç–µ–º –≤—ã–∏–≥—Ä–∞—Ç—å —à–µ—Å—Ç—É—é' } 
        },
        alertAchieveGenius: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ –¥–ª—è –≥–µ–Ω–∏—è!',
        alertAchieveEasy: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –≠—Ç–æ –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ!',
        alertAchieveFirst: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –Ø —Å–¥–µ–ª–∞–ª —ç—Ç–æ!',
        alertAchieveEncyclopedist: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—Å—Ç!',
        alertAchieveClueSniper: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –°–Ω–∞–π–ø–µ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫!',
        alertAchieveBigRangeWin: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: 1 –º–∏–Ω–∞, –±–æ–ª—å—à–æ–µ –ø–æ–ª–µ!',
        alertAchieveForeignNoClue: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –ß—Ç–æ –≥–æ–≤–æ—Ä–∏—à—å?!',
        alertAchieveImpossibleChallenge: '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –≠—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!',
        reportButton: '–°–æ–æ–±—â–∏—Ç—å –æ –±–∞–≥–µ',
        langButton: 'Eng',
        toggleRangeButton: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞',
        clueMoreThan: (num) => `–ß–∏—Å–ª–æ —Ç–æ—á–Ω–æ –±–æ–ª—å—à–µ ${num}`,
        clueLessThan: (num) => `–ß–∏—Å–ª–æ —Ç–æ—á–Ω–æ –º–µ–Ω—å—à–µ ${num}`,
        clueClosestSquare: (num) => `–≠—Ç–æ —á–∏—Å–ª–æ –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –∫–≤–∞–¥—Ä–∞—Ç—É —á–∏—Å–ª–∞ ${num}`,
        clueEven: '–≠—Ç–æ —á–∏—Å–ª–æ —á—ë—Ç–Ω–æ–µ',
        clueOdd: '–≠—Ç–æ —á–∏—Å–ª–æ –Ω–µ—á—ë—Ç–Ω–æ–µ',
        cluePrime: '–≠—Ç–æ —á–∏—Å–ª–æ –ø—Ä–æ—Å—Ç–æ–µ',
        clueNotPrime: '–≠—Ç–æ —á–∏—Å–ª–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ–µ',
        clueDivisibleBy: (num) => `–≠—Ç–æ —á–∏—Å–ª–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ ${num}`,
        clueSumOfDigits: (sum) => `–°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞ —Ä–∞–≤–Ω–∞ ${sum}`,
        clueContainsDigit: (digit) => `–ß–∏—Å–ª–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—É ${digit}`,
        clueClosestRound: (num) => `–ß–∏—Å–ª–æ –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ ${num}`,
    },
    'en': {
        gameTitle: 'üéâ Guess The Number Game! üéâ',
        messageInitial: 'Try to guess the number from 1 to 100!',
        messageWithRange: (min, max) => `Try to guess the number from ${min} to ${max}!`,
        inputPlaceholder: 'Enter your guess...',
        checkButton: '‚úÖ Check!',
        resetButton: 'üîÑ Reset Game',
        getClueButton: '‚ùì Clue',
        toggleAchievementsButton: 'üèÜ Achievements',
        resultEnterNumber: (min, max) => `You must enter a number between ${min} and ${max}!`,
        resultInvalidRange: 'Invalid number range! Min number from 1 to 99, Max from 2 to 1000, and Min must be less than Max.',
        resultAlreadyGuessed: 'You already guessed this number! Try another.',
        resultCorrect: (num, att) => `üéâ Correct! You guessed ${num}. Attempts: ${att} üéâ`,
        resultTooHigh: 'Incorrect! Go lower.',
        resultTooLow: 'Incorrect! Go higher.',
        cluesHeader: 'Clues:',
        noMoreClues: 'No more clues available!',
        achievementsTitle: 'Your Achievements',
        achievements: {
            'genius_guess': { name: 'Genius Guess', description: 'Guess the number in 1 attempt' },
            'easy_peasy': { name: 'Easy Peasy', description: 'Guess the number in less than 5 attempts' },
            'first_win': { name: 'I Did It', description: 'Win for the first time' },
            'encyclopedist': { name: 'Encyclopedist', description: 'Use 5 different clue types in one game' },
            'clue_sniper': { name: 'Clue Sniper', description: 'Guess the number using no more than 2 clues' },
            'big_range_win': { name: '1 Mine, Big Field', description: 'Win in range with max > 200' }, 
            'foreign_no_clue': { name: 'What Are You Saying?', description: 'Win in English without clues' }, 
            'impossible_challenge': { name: 'This Is Impossible', description: 'Lose 5 games in a row, then win the sixth' } 
        },
        alertAchieveGenius: 'Achievement Unlocked: Genius Guess!',
        alertAchieveEasy: 'Achievement Unlocked: Easy Peasy!',
        alertAchieveFirst: 'Achievement Unlocked: I Did It!',
        alertAchieveEncyclopedist: 'Achievement Unlocked: Encyclopedist!',
        alertAchieveClueSniper: 'Achievement Unlocked: Clue Sniper!',
        alertAchieveBigRangeWin: 'Achievement Unlocked: 1 Mine, Big Field!',
        alertAchieveForeignNoClue: 'Achievement Unlocked: What Are You Saying?!',
        alertAchieveImpossibleChallenge: 'Achievement Unlocked: This Is Impossible!',
        reportButton: 'Report Bug',
        langButton: 'Ru',
        toggleRangeButton: 'Range Settings',
        clueMoreThan: (num) => `The number is definitely greater than ${num}`,
        clueLessThan: (num) => `The number is definitely less than ${num}`,
        clueClosestSquare: (num) => `This number is closest to the square of ${num}`,
        clueEven: 'This number is even',
        clueOdd: 'This number is odd',
        cluePrime: 'This number is prime',
        clueNotPrime: 'This number is not prime',
        clueDivisibleBy: (num) => `This number is divisible by ${num}`,
        clueSumOfDigits: (sum) => `The sum of the digits is ${sum}`,
        clueContainsDigit: (digit) => `The number contains the digit ${digit}`,
        clueClosestRound: (num) => `The number is closest to ${num}`,
    }
};

let achievements = {
    'genius_guess': { name: '', description: '', unlocked: false },
    'easy_peasy': { name: '', description: '', unlocked: false },
    'first_win': { name: '', description: '', unlocked: false },
    'encyclopedist': { name: '', description: '', unlocked: false }, 
    'clue_sniper': { name: '', description: '', unlocked: false },
    'big_range_win': { name: '', description: '', unlocked: false }, 
    'foreign_no_clue': { name: '', description: '', unlocked: false }, 
    'impossible_challenge': { name: '', description: '', unlocked: false } 
};

function loadAchievements() {
    const savedAchievements = localStorage.getItem('guessTheNumberAchievements');
    if (savedAchievements) {
        const parsed = JSON.parse(savedAchievements);
        for(const key in achievements) {
            if (parsed[key]) {
                achievements[key].unlocked = parsed[key].unlocked;
            }
        }
    }
}

function saveAchievements() {
    localStorage.setItem('guessTheNumberAchievements', JSON.stringify(achievements));
}

function setBackground(theme) {
    if (backgrounds[theme]) {
        document.body.style.backgroundImage = backgrounds[theme];
        currentBackground = theme; 
        localStorage.setItem('guessTheNumberBackground', theme);
    }
}

function updateTexts() {
    const currentTexts = texts[currentLang];

    document.getElementById('game-title').textContent = currentTexts.gameTitle;
    document.getElementById('guessInput').placeholder = currentTexts.inputPlaceholder;
    document.getElementById('check-button').textContent = currentTexts.checkButton;
    document.getElementById('reset-button').textContent = currentTexts.resetButton;
    document.getElementById('get-clue-button').textContent = currentTexts.getClueButton; 
    document.getElementById('clues-header').textContent = currentTexts.cluesHeader;
    document.getElementById('achievements-title').textContent = currentTexts.achievementsTitle;
    document.getElementById('report-button').textContent = currentTexts.reportButton;
    document.getElementById('lang-button').textContent = currentTexts.langButton;
    document.getElementById('toggle-range-button').textContent = currentTexts.toggleRangeButton;
    document.getElementById('toggle-achievements-button').textContent = currentTexts.toggleAchievementsButton; 

    document.getElementById('message').textContent = currentTexts.messageWithRange(minNumber, maxNumber);

    for (const key in achievements) {
        achievements[key].name = currentTexts.achievements[key].name;
        achievements[key].description = currentTexts.achievements[key].description;
    }

    renderAchievements();

    if (currentBackground === 'dark') {
        document.getElementById('game-title').style.color = 'white';
        document.getElementById('message').style.color = 'lightgray';
    } else {
        document.getElementById('game-title').style.color = 'white'; 
        document.getElementById('message').style.color = 'white';
    }
}

function toggleLanguage() {
    currentLang = currentLang === 'ru' ? 'en' : 'ru';
    localStorage.setItem('guessTheNumberLang', currentLang);
    updateTexts();
}

function reportBug() {
    const email = 'ktowka18@gmail.com';
    const subject = encodeURIComponent(`–ë–∞–≥ –≤ –∏–≥—Ä–µ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ (${GAME_VERSION})`);
    const body = encodeURIComponent(
        `–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–∞–≥: [–û–ø–∏—à–∏—Ç–µ –±–∞–≥ –∑–¥–µ—Å—å]\n\n` +
        `–í–µ—Ä—Å–∏—è –∏–≥—Ä—ã: ${GAME_VERSION}\n` +
        `–¢–µ–∫—É—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω: ${minNumber} - ${maxNumber}\n` +
        `–°–¥–µ–ª–∞–Ω–æ –ø–æ–ø—ã—Ç–æ–∫: ${attempts}\n` +
        `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫: ${clues.length}\n` +
        `[–î–æ–±–∞–≤—å—Ç–µ –ª—é–±—É—é –¥—Ä—É–≥—É—é –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é]`
    );
    window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
}

function renderAchievements() {
    const achievementsList = document.getElementById('achievements-list');
    achievementsList.innerHTML = '';

    for (const key in achievements) {
        const ach = achievements[key];
        const item = document.createElement('div');
        item.classList.add('achievement-item');
        if (ach.unlocked) {
            item.classList.add('unlocked');
        }
        item.textContent = `${ach.name}: ${ach.description}`;
        achievementsList.appendChild(item);
    }
}

function toggleAchievements() {
    const achievementsContainer = document.getElementById('achievements-container');
    if (achievementsContainer.style.display === 'none') {
        achievementsContainer.style.display = 'block';
    } else {
        achievementsContainer.style.display = 'none';
    }
}

function checkAchievements() {
    const currentTexts = texts[currentLang];
    if (attempts === 1 && !achievements.genius_guess.unlocked) {
        achievements.genius_guess.unlocked = true;
        alert(currentTexts.alertAchieveGenius);
    }
    if (attempts <= 5 && !achievements.easy_peasy.unlocked) {
        achievements.easy_peasy.unlocked = true;
        alert(currentTexts.alertAchieveEasy);
    }
    if (!achievements.first_win.unlocked) {
        achievements.first_win.unlocked = true;
        alert(currentTexts.alertAchieveFirst);
    }
    
    if (usedClueTypesInCurrentGame.size >= 5 && !achievements.encyclopedist.unlocked) {
        achievements.encyclopedist.unlocked = true;
        alert(currentTexts.alertAchieveEncyclopedist);
    }

    if (clues.length <= 2 && !achievements.clue_sniper.unlocked) {
        achievements.clue_sniper.unlocked = true;
        alert(currentTexts.alertAchieveClueSniper);
    }

    if (maxNumber > 200 && !achievements.big_range_win.unlocked) {
        achievements.big_range_win.unlocked = true;
        alert(currentTexts.alertAchieveBigRangeWin);
    }

    if (currentLang === 'en' && clues.length === 0 && !achievements.foreign_no_clue.unlocked) {
        achievements.foreign_no_clue.unlocked = true;
        alert(currentTexts.alertAchieveForeignNoClue);
    }

    if (consecutiveLosses >= 5 && !achievements.impossible_challenge.unlocked) {
        achievements.impossible_challenge.unlocked = true;
        alert(currentTexts.alertAchieveImpossibleChallenge);
    }

    saveAchievements();
    renderAchievements();

    consecutiveLosses = 0;
    localStorage.setItem('guessTheNumberLosses', consecutiveLosses);
}

function generateRandomNumber() {
    return Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
}

function isPrime(num) {
    for (let i = 2, s = Math.sqrt(num); i <= s; i++) {
        if (num % i === 0) return false;
    }
    return num > 1;
}

function closestSquareRoot(num) {
    return Math.round(Math.sqrt(num));
}

function sumDigits(num) {
    let sum = 0;
    let strNum = String(num); 
    for (let i = 0; i < strNum.length; i++) {
        sum += parseInt(strNum[i], 10); 
    }
    return sum;
}

function closestRoundNumber(num) {
    const roundNumbers = [];
    for (let i = 1; i <= Math.floor(maxNumber / 10); i++) {
        roundNumbers.push(i * 10);
    }
    if (roundNumbers.length === 0) {
        if (maxNumber >= 10) roundNumbers.push(10);
        else roundNumbers.push(minNumber);
    } else if (maxNumber > 10 && !roundNumbers.includes(10)) { 
        roundNumbers.unshift(10); 
    }

    let closest = roundNumbers[0];
    let minDiff = Math.abs(num - closest);

    for (let i = 1; i < roundNumbers.length; i++) {
        const diff = Math.abs(num - roundNumbers[i]);
        if (diff < minDiff) {
            minDiff = diff;
            closest = roundNumbers[i];
        }
    }
    return closest;
}

function initializeClueOptions() {
    const currentTexts = texts[currentLang];
    availableClueOptions = []; 

    const lowerBoundForMoreThan = Math.max(minNumber, targetNumber - Math.floor(Math.random() * (maxNumber - minNumber) / 10) - 1);
    if (lowerBoundForMoreThan < targetNumber) {
        availableClueOptions.push({ id: 'clue_more_than', getClue: () => currentTexts.clueMoreThan(lowerBoundForMoreThan) });
    }

    const upperBoundForLessThan = Math.min(maxNumber, targetNumber + Math.floor(Math.random() * (maxNumber - minNumber) / 10) + 1);
    if (upperBoundForLessThan > targetNumber) {
        availableClueOptions.push({ id: 'clue_less_than', getClue: () => currentTexts.clueLessThan(upperBoundForLessThan) });
    }

    availableClueOptions.push({ id: 'clue_closest_square', getClue: () => currentTexts.clueClosestSquare(closestSquareRoot(targetNumber)) });

    if (targetNumber % 2 === 0) {
        availableClueOptions.push({ id: 'clue_even', getClue: () => currentTexts.clueEven });
    } else {
        availableClueOptions.push({ id: 'clue_odd', getClue: () => currentTexts.clueOdd });
    }

    if (isPrime(targetNumber)) {
        availableClueOptions.push({ id: 'clue_prime', getClue: () => currentTexts.cluePrime });
    } else if (targetNumber > 1) { 
        availableClueOptions.push({ id: 'clue_not_prime', getClue: () => currentTexts.clueNotPrime });
    }

    if (targetNumber > 1) { 
        const possibleDivisors = [];
        for (let i = 2; i <= Math.min(10, targetNumber); i++) { 
            if (targetNumber % i === 0) {
                possibleDivisors.push(i);
            }
        }
        
        if (possibleDivisors.length > 0) {
            const randomDivisor = possibleDivisors[Math.floor(Math.random() * possibleDivisors.length)];
            availableClueOptions.push({ id: 'clue_divisible_by', getClue: () => currentTexts.clueDivisibleBy(randomDivisor) });
        }
    }

    if (targetNumber > 0) { 
        availableClueOptions.push({ id: 'clue_sum_of_digits', getClue: () => currentTexts.clueSumOfDigits(sumDigits(targetNumber)) });
    }

    if (targetNumber > 0) {
        const digits = String(targetNumber).split('').map(Number); 
        if (digits.length > 0) {
            const randomDigit = digits[Math.floor(Math.random() * digits.length)]; 
            availableClueOptions.push({ id: 'clue_contains_digit', getClue: () => currentTexts.clueContainsDigit(randomDigit) });
        }
    }

    availableClueOptions.push({ id: 'clue_closest_round', getClue: () => currentTexts.clueClosestRound(closestRoundNumber(targetNumber)) });
}

function toggleRangeSettings() {
    const rangeSettings = document.getElementById('range-settings');
    if (rangeSettings.style.display === 'none') {
        rangeSettings.style.display = 'block';
        document.getElementById('minRangeInput').value = minNumber;
        document.getElementById('maxRangeInput').value = maxNumber;
    } else {
        rangeSettings.style.display = 'none';
    }
}

function startGameWithRange() {
    const currentTexts = texts[currentLang];
    let newMin = parseInt(document.getElementById('minRangeInput').value, 10);
    let newMax = parseInt(document.getElementById('maxRangeInput').value, 10);

    if (isNaN(newMin) || isNaN(newMax) || newMin < 1 || newMax > 1000 || newMin >= newMax) {
        alert(currentTexts.resultInvalidRange);
        return;
    }

    minNumber = newMin;
    maxNumber = newMax;
    document.getElementById('guessInput').min = minNumber;
    document.getElementById('guessInput').max = maxNumber;
    
    resetGame(); 
    toggleRangeSettings(); 
    updateTexts(); 
}

function getNewClue() {
    const cluesList = document.getElementById('clues-list');
    const currentTexts = texts[currentLang];

    if (availableClueOptions.length > 0) {
        let randomIndex = Math.floor(Math.random() * availableClueOptions.length);
        let selectedClueObject = availableClueOptions.splice(randomIndex, 1)[0]; 
        let newClueText = selectedClueObject.getClue();
        clues.push(newClueText); 
        usedClueTypesInCurrentGame.add(selectedClueObject.id); 
        
        let item = document.createElement('li');
        item.textContent = `${clues.length}) ${newClueText}`;
        cluesList.appendChild(item);

        if (availableClueOptions.length === 0) {
            document.getElementById('get-clue-button').disabled = true;
        }
    } else {
        alert(currentTexts.noMoreClues);
        document.getElementById('get-clue-button').disabled = true;
    }
}

function setupGame() {
    targetNumber = generateRandomNumber();
    attempts = 0;
    history = [];
    clues = []; 
    usedClueTypesInCurrentGame = new Set(); 
    isWon = false; 
    initializeClueOptions(); 
    document.getElementById('message').textContent = texts[currentLang].messageWithRange(minNumber, maxNumber);
    document.getElementById('get-clue-button').disabled = false; 
    document.getElementById('clues-list').innerHTML = ''; 
    console.log("–ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ:", targetNumber);
}

function checkGuess() {
    const guessInput = document.getElementById('guessInput');
    const guess = parseInt(guessInput.value.trim(), 10);
    const resultElement = document.getElementById('result');
    const messageElement = document.getElementById('message');
    const currentTexts = texts[currentLang];

    if (!guess || isNaN(guess) || guess < minNumber || guess > maxNumber) {
        alert(currentTexts.resultEnterNumber(minNumber, maxNumber));
        guessInput.value = '';
        return;
    }

    if (history.includes(guess)) {
        resultElement.classList.remove('green-text', 'yellow-text', 'blue-text');
        resultElement.classList.add('red-text');
        resultElement.textContent = currentTexts.resultAlreadyGuessed;
        guessInput.value = '';
        return;
    }

    attempts++;
    history.push(guess);

    if (guess === targetNumber) {
        resultElement.classList.remove('yellow-text', 'blue-text', 'red-text');
        resultElement.classList.add('green-text');
        resultElement.textContent = currentTexts.resultCorrect(targetNumber, attempts);
        messageElement.style.display = 'none';
        guessInput.disabled = true; 
        document.getElementById('get-clue-button').disabled = true; 
        isWon = true; 
        checkAchievements(); 
    } else if (guess > targetNumber) {
        resultElement.classList.remove('green-text', 'yellow-text', 'blue-text');
        resultElement.classList.add('red-text');
        resultElement.textContent = currentTexts.resultTooHigh;
    } else {
        resultElement.classList.remove('green-text', 'yellow-text', 'red-text');
        resultElement.classList.add('blue-text');
        resultElement.textContent = currentTexts.resultTooLow;
    }

    guessInput.value = ''; 
}

function resetGame() {
    if (!isWon) { 
        consecutiveLosses++;
        localStorage.setItem('guessTheNumberLosses', consecutiveLosses);
    } else { 
        consecutiveLosses = 0;
        localStorage.setItem('guessTheNumberLosses', consecutiveLosses);
    }

    setupGame(); 
    const resultElement = document.getElementById('result');
    const guessInput = document.getElementById('guessInput');
    const cluesList = document.getElementById('clues-list');

    resultElement.textContent = '';
    resultElement.classList.remove('green-text', 'yellow-text', 'blue-text', 'red-text');
    document.getElementById('message').style.display = '';
    document.getElementById('message').textContent = texts[currentLang].messageWithRange(minNumber, maxNumber);
    guessInput.value = '';
    guessInput.disabled = false;
    document.getElementById('get-clue-button').disabled = false; 
    cluesList.innerHTML = ''; 
    renderAchievements();
    updateTexts(); 
}

loadAchievements();
setupGame();
setBackground(currentBackground); 
updateTexts(); 
renderAchievements();
</script>

</body>
</html>
